<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/stylesheets/student-dashboard.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
    <style>
        .table-container {
            margin: 25px;
            box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
        }
    </style>
</head>

<body>

    <nav class="custom-navbar navbar-light header-container">
        <!-- Company Logo -->
        <a class="navbar-brand" href="/admin/dashboard">
            <img src="/images/logo.png" width="50" height="50" class="d-inline-block align-top" alt="">
        </a>

        <!-- Person Logo and Logout Dropdown -->
        <div class="person-logout d-flex">
            <!-- Custom Dropdown -->
            <div class="custom-dropdown mr-3">
                <button class="custom-btn " type="button" id="dropdownMenuButton" aria-haspopup="true"
                    aria-expanded="false">
                    <img src="/images/student-logo.jpg" width="50" height="50" alt="Person Logo">
                    <%= user_name %>
                </button>

                <button class="logout-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 24 24" fill="none">
                        <path
                            d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z"
                            stroke="#ffffff" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path
                            d="M2 12.8799V11.1199C2 10.0799 2.85 9.21994 3.9 9.21994C5.71 9.21994 6.45 7.93994 5.54 6.36994C5.02 5.46994 5.33 4.29994 6.24 3.77994L7.97 2.78994C8.76 2.31994 9.78 2.59994 10.25 3.38994L10.36 3.57994C11.26 5.14994 12.74 5.14994 13.65 3.57994L13.76 3.38994C14.23 2.59994 15.25 2.31994 16.04 2.78994L17.77 3.77994C18.68 4.29994 18.99 5.46994 18.47 6.36994C17.56 7.93994 18.3 9.21994 20.11 9.21994C21.15 9.21994 22.01 10.0699 22.01 11.1199V12.8799C22.01 13.9199 21.16 14.7799 20.11 14.7799C18.3 14.7799 17.56 16.0599 18.47 17.6299C18.99 18.5399 18.68 19.6999 17.77 20.2199L16.04 21.2099C15.25 21.6799 14.23 21.3999 13.76 20.6099L13.65 20.4199C12.75 18.8499 11.27 18.8499 10.36 20.4199L10.25 20.6099C9.78 21.3999 8.76 21.6799 7.97 21.2099L6.24 20.2199C5.33 19.6999 5.02 18.5299 5.54 17.6299C6.45 16.0599 5.71 14.7799 3.9 14.7799C2.85 14.7799 2 13.9199 2 12.8799Z"
                            stroke="#ffffff" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>

                <button class="logout-button">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#ffffff"
                        height="20px" width="20px" version="1.1" id="XMLID_281_" viewBox="0 0 24 24"
                        xml:space="preserve">
                        <g>
                            <path
                                d="M12,24C5.4,24,0,18.6,0,12S5.4,0,12,0s12,5.4,12,12S18.6,24,12,24z M12,2C6.5,2,2,6.5,2,12s4.5,10,10,10s10-4.5,10-10   S17.5,2,12,2z" />
                        </g>
                        <g>
                            <path
                                d="M12.4,11.7c-1.1,1.2-1.4,1.8-1.5,3.1h2.4c0-0.5,0.2-1,1-1.9c1.1-1.2,2.4-2.4,2.4-4.2c0-2.7-1.8-4.2-4.6-4.2   c-1.8,0-3.4,0.7-4.4,1.8v2.5c1-1,2.5-2,4.3-2c1.5,0,2.3,0.7,2.3,2S13.2,10.8,12.4,11.7z M10.3,17.9c0,0.9,0.7,1.7,1.6,1.7   s1.6-0.7,1.6-1.7s-0.7-1.7-1.6-1.7S10.3,17,10.3,17.9z" />
                        </g>
                    </svg>
                </button>

                <button class="logout-button" id="logout-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 16 16">
                        <g color="#000000" fill="#ffffff" font-family="sans-serif" font-weight="400"
                            white-space="normal">
                            <path
                                d="M1 7.92a6.94 6.94 0 0 0 .324 2.201A7.004 7.004 0 0 0 8 15a7.004 7.004 0 0 0 6.676-4.879 6.978 6.978 0 0 0-2.662-7.818l-1.145 1.64a4.96 4.96 0 0 1 1.9 5.575A4.99 4.99 0 0 1 8 13a4.99 4.99 0 0 1-4.77-3.482 4.96 4.96 0 0 1 1.9-5.575l-1.144-1.64A6.985 6.985 0 0 0 1 7.92z"
                                overflow="visible"
                                style="line-height:normal;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000000;text-transform:none;text-orientation:mixed;shape-padding:0;isolation:auto;mix-blend-mode:normal" />
                            <path d="M7 1v7h2V.75z" overflow="visible"
                                style="line-height:normal;font-variant-ligatures:none;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000000;text-transform:none;shape-padding:0;isolation:auto;mix-blend-mode:normal;marker:none" />
                        </g>
                    </svg>
                </button>
            </div>
        </div>
    </nav>

    <h1 style="text-align: center;color: #fff;">Students</h1>
    <div class="table-container">
        <h2 style="text-align: center;color: #fff;">Approve or Reject Student Logins</h2>
        <% if (students.length> 0) { %>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <th style="border: 1px solid #ddd;background-color: #fff; padding: 8px;color:#000;">ID</th>
                    <th style="border: 1px solid #ddd;background-color: #fff; padding: 8px;color:#000;">Username</th>
                    <th style="border: 1px solid #ddd;background-color: #fff; padding: 8px;color:#000;">Email</th>
                    <th style="border: 1px solid #ddd;background-color: #fff; padding: 8px;color:#000;">Mobile</th>
                    <th style="border: 1px solid #ddd;background-color: #fff; padding: 8px;color:#000;">Course</th>
                    <th style="border: 1px solid #ddd;background-color: #fff; padding: 8px;color:#000;">Role</th>
                    <th style="border: 1px solid #ddd;background-color: #fff; padding: 8px;color:#000;">Is Approved</th>
                    <th style="border: 1px solid #ddd;background-color: #fff; padding: 8px;color:#000;">Action</th>
                </thead>

                <tbody>
                    <% students.forEach(student=> { %>
                        <tr style="background-color: #f9f9f9;">
                            <td style="padding: 8px; border: 1px solid #ddd;">
                                <%= student?.id %>
                            </td>
                            <td style="padding: 8px; border: 1px solid #ddd;">
                                <%= student?.username %>
                            </td>
                            <td style="padding: 8px; border: 1px solid #ddd;">
                                <%= student?.email %>
                            </td>
                            <td style="padding: 8px; border: 1px solid #ddd;">
                                <%= student?.mobile %>
                            </td>
                            <td style="padding: 8px; border: 1px solid #ddd;">
                                <%= student.Course?.course_name %>
                            </td>
                            <td style="padding: 8px; border: 1px solid #ddd;">
                                <%= student?.role %>
                            </td>
                            <td style="padding: 8px; border: 1px solid #ddd;">
                                <% if (student.is_approved) { %>
                                    <span style="color: green;">Approved</span>
                                <% } else { %>
                                    <span style="color: red;">Pending Approval</span>
                                <% } %>
                            </td>
                            <td style="padding: 8px; border: 1px solid #ddd; display: flex; flex-direction: row;
                            align-items: center; justify-content: center;">
                                <button onclick="approveStudent('<%= student.id %>')"
                                    style="border: none; width: 150px; cursor: pointer; background-color: #4CAF50; color: #fff; height: 35px; margin-right: 10px;">
                                    Approve
                                </button>
                                <button onclick="rejectStudent('<%= student.id %>')"
                                    style="border: none; width: 150px; cursor: pointer; background-color: #f70000; color: #fff; height: 35px; margin-left: 10px;">
                                    Reject
                                </button>
                            </td>

                        </tr>
                        <% }) %>
                </tbody>
            </table>
            <% } else { %>
                <p>No exam results found.</p>
                <% } %>
    </div>

</body>
<script>
    function approveStudent(studentId) {
        // Make API call to approve student with ID studentId
        fetch(`/admin/users/${studentId}/approve`, { // Adjusted route path
            method: 'PUT', // Changed method to PUT
            headers: {
                'Content-Type': 'application/json',
            }
        }).then(response => {
            if (response.ok) {
                // Handle success response
                location.reload()
                console.log('Student approved successfully');
            } else {
                // Handle non-success response
                console.error('Failed to approve student:', response.statusText);
            }
        }).catch(error => {
            // Handle error
            console.error('Error approving student:', error);
        });
    }

    function rejectStudent(studentId) {
        // Make API call to reject student with ID studentId
        fetch(`/admin/users/${studentId}/reject`, { // Adjusted route path
            method: 'PUT', // Changed method to PUT
            headers: {
                'Content-Type': 'application/json',
            }
        }).then(response => {
            if (response.ok) {
                // Handle success response
                location.reload()
                console.log('Student rejected successfully');
            } else {
                // Handle non-success response
                console.error('Failed to reject student:', response.statusText);
            }
        }).catch(error => {
            // Handle error
            console.error('Error rejecting student:', error);
        });
    }


    document.getElementById('logout-button').addEventListener('click', function () {
        fetch('/users/logout', {
            method: 'POST',
            credentials: 'same-origin' // Include cookies with the request
        })
            .then(response => {
                if (response.ok) {
                    // Redirect to the login page
                    window.location.href = '/users/admin/login';
                } else {
                    alert('Failed to log out');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to log out');
            });
    });
</script>

<script>
    console.log("<%= JSON.stringify(students) %>")
</script>

</html>